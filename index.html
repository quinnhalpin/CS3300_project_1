<!DOCTYPE html>
<html>
<meta charset="utf-8">
<head>
    <title>Project One</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="http://d3js.org/topojson.v2.min.js"></script>
</head>

<link href="https://fonts.googleapis.com/css?family=Fauna+One|Playfair+Display|Lato" rel="stylesheet">

<style>
    svg { 
    font-family: 'Lato', sans-serif; 
    border: solid #ccc 1px;
    background-color: #ffffff; 
    }
    body { background-color: #ffffff;}
    p {
      font-family: 'Ubuntu', sans-serif;
      max-width: 800px; 
      color: black; 
      font-size:14pt;
    }
  /*h1 {font-family: 'Ubuntu', sans-serif;}  */
    
    section, div {
      font-family: 'Fauna One';
      display: -webkit-flex;
        display: flex;
        display: -webkit-flex;
       display: flex;
       -webkit-flex-direction: column; 
       flex-direction: column;
       -webkit-align-items: center;
       align-items: center;
       -webkit-justify-content: center;
       justify-content: center;
       margin-bottom: 4vh;
    }

    h1 {
        font-family: 'Playfair Display';
        font-size: 3em;
    }

    h2 {
        font-size: 2em;
        margin: 1em;
    }
    .descriptions{
        font-family: 'Lato';
        width: 800px;
    }

    #intro {
      height: 50vh;
    }
    section #explaination {
        font-family: 'Lato';
        font-size: 3em;
        width: 3000px;
    }

    
</style>
<body>
    <section id="intro">
        <h1>Migration in the Middle East: Prediction vs Actual</h1>
        <h2>By Sofie Cornelis, Quinn Halpin, and Weston Forster</h3>
    </section>
    <section>
        <p id="explaination">In 2010, UN projected the 2015 net migration of Middle Eastern countries. However, things did not turn out as they expect. This project explores the predicted and actual data.</p>
    </section>
    <section id="maps">
        <h2>Actual Net Migration recorded in the Middle East in 2012</h2>
    </section>
    <section id="predicted_barchart">
        <p class="descriptions">While this was how people actually moved throughout the Middle East the below compares the real data to the predicted data. While the UN is usually accurate about their predictions, they were far from correct.</p>
        
        <h2>UN Predicted Net Migration for the Middle East</h2>
    </section>
    <section id="actual_barchart">
        <p class="descriptions">WES WIRTE ABOUT CHARTS HERE</p>
        <h2>Actual Net Migration recorded in the Middle East</h2>
    </section>

    <section id="scatter">
        <h2>UN's Projected Net Migration vs the Actual Recorded Net Migration</h2>
        <p class="descriptions">
            In April of 2011, 5000 Refugees fleed harsh fighting in Talkalakh, Syria, sparking the Syrian Refugee Crisis. In June of 2011, the military seige of Jisr al-Shughour sparks a major flow of refugees into Turkey. By the end of 2011, Turkey had spent $15 million to set up six camps for thousands of Syrian refugees. Between
        </p>
    </section>
    <script type="text/javascript">
    var dataset, nestedData, rawData, countries, popAreaData, nestBankData, countryBank;
    var migration_log;
    var projection = d3.geoMercator().scale(125);
    var projection_out = d3.geoMercator().scale(300);
    var projection3 = d3.geoMercator().scale(300);
    var pathGenerator = d3.geoPath().projection(projection);
    var svgMap = d3.select("#maps").append("svg").attr("width", 800).attr("height", 800)
        .style("background", "#E2FCFF"); //makes the svg map background light blue;
    var svgZoom = d3.select("#maps").append("svg").attr("width", 800).attr("height", 800)
        .style("background", "#E2FCFF"); //makes the svg map background light blue;
    var svgChart = d3.select("#predicted_barchart").append("svg").attr("width", 1200).attr("height", 600).style("background", "#FCFEFF");
    var svgChartActual = d3.select("#actual_barchart").append("svg").attr("width", 1200).attr("height", 900).style("background", "#FCFEFF");
    var netmigration_svg = d3.select("#scatter").append("svg").attr("width", 1400).attr("height", 800)
        .style("background", "#FCFEFF");

    d3.queue()
        .defer(d3.csv, "large-tabular.csv")
        .defer(d3.csv, "net_migration_mideast.csv")
        .defer(d3.json, "world-50m.json")
        .defer(d3.json, "middle_east_pop_area.json")
        .await(done_function);
    scale_country_id = {
        48: 7,
        818: .4,
        364: .2,
        368: .4,
        376: 1,
        400: .8,
        414: 1.3,
        422: 1.5,
        512: .4,
        275: 2,
        634: 2,
        682: .2,
        760: .7,
        792: .4,
        784: 1,
        887: .5
    }
    small_scale_country_id = {
        48: 7,
        818: .2,
        364: .15,
        368: .25,
        376: .8,
        400: .6,
        414: 1.3,
        422: 1.5,
        512: .4,
        275: 2,
        634: 2,
        682: .15,
        760: .4,
        784: .6,
        792: .25,
        887: .4,
        434: .2,
        736: .4,
        706: .3,
        249: .4
    }
    small_country_arr = {
        "Yemen": {
            "ind": 15,
            "id": 887
        },
        "Egypt": {
            "ind": 1,
            "id": 818
        },
        "Bahrain": {
            "ind": 0,
            "id": 48
        },
        "Iraq": {
            "ind": 3,
            "id": 368
        },
    }
    country_id = {
        "BHR": {
            "name": "Bahrain",
            "ind": 0,
            "id": 48
        },
        "EGY": {
            "name": "Egypt",
            "ind": 1,
            "id": 818
        },
        "IRN": {
            "name": "Iran",
            "ind": 2,
            "id": 364
        },
        "IRQ": {
            "name": "Iraq",
            "ind": 3,
            "id": 368
        },
        "ISR": {
            "name": "Israel",
            "ind": 4,
            "id": 376
        },
        "JOR": {
            "name": "Jordan",
            "ind": 5,
            "id": 400
        },
        "KWT": {
            "name": "Kuwait",
            "ind": 6,
            "id": 414
        },
        "LBN": {
            "name": "Lebanon",
            "ind": 7,
            "id": 422
        },
        "OMN": {
            "name": "Oman",
            "ind": 8,
            "id": 512
        },
        "PSE": {
            "name": "Palestine",
            "ind": 9,
            "id": 275
        },
        "QAT": {
            "name": "Qatar",
            "ind": 10,
            "id": 634
        },
        "SAU": {
            "name": "Saudi Arabia",
            "ind": 11,
            "id": 682
        },
        "SYR": {
            "name": "Syria",
            "ind": 12,
            "id": 760
        },
        "ARE": {
            "name": "U. Arab Emirates",
            "ind": 14,
            "id": 784
        },
        "TUR": {
            "name": "Turkey",
            "ind": 13,
            "id": 792
        },
        "YEM": {
            "name": "Yemen",
            "ind": 15,
            "id": 887
        },
        "SDN": {
            "name": "Sudan",
            "ind": 16,
            "id": 736
        }
    }
    id_to_acry = {
        "48": "BHR",
        "818": "EGY",
        "364": "IRN",
        "368": "IRQ",
        "376": "ISR",
        "400": "JOR",
        "414": "KWT",
        "422": "LBN",
        "512": "OMN",
        "275": "PSE",
        "634": "QAT",
        "682": "SAU",
        "760": "SYR",
        "784": "ARE",
        "792": "TUR",
        "887": "YEM",
    }
    id_to_country = {
        "48": "Bahrain",
        "818": "Egypt",
        "364": "Iran",
        "368": "Iraq",
        "376": "Israel",
        "400": "Jordan",
        "414": "Kuwait",
        "422": "Lebanon",
        "512": "Oman",
        "275": "Palestine",
        "634": "Qatar",
        "682": "Saudi Arabia",
        "760": "Syria",
        "784": "U. Arab Emirates",
        "792": "Turkey",
        "887": "Yemen",
    }
    id_to_ind = [48, 818, 364, 368, 376, 400, 414, 422, 512, 634, 682, 760, 784, 792, 887];

    /* This function returns an array countryData containing an object for each country with fields of the 2015 data for each variable*/

    function done_function(error, csv_data, bank_csv, world_json_data, pop_area) {
        dataset = csv_data;
        bankdata = bank_csv;
        nestedData = d3.nest()
            .key(function(d) {
                return d.REF_AREA;
            })
            .entries(csv_data);
        nestBankData = d3.nest()
            .key(function(d) {
                return d.Country_Name;
            })
            .entries(bank_csv);
        
        // Country bank has all values for netMigration stored with index 0 being 1960 and index 57 being 2016. Most values are empty strings but all are defined.
        countryBank = nestBankData.map(function(country) {
            var bankResult = {
                Country: country.key
            };
            yearValue = Object(country.values[0]);
            var keys = Object.keys(yearValue).slice(0, 57);
            var values = Object.values(yearValue).slice(0, 57);
            bankResult.Years = keys;
            bankResult.Values = values;
            // Returns the 2012 value for NetMigration
            bankResult.NetMigration = values[52];
            //threeCode is the Three digit country code
            bankResult.ThreeCode = country.values[0].Country_Code;
            return bankResult;
        });
        
        countryData = nestedData.map(function(country) {
            var result = {
                Country: country.key
            };
            country.values.forEach(function(d) {
                if (d.TIME_PERIOD == "2015") {
                    if (d.INDICATOR == "SM_POP_NETM") {
                        result.NetMigration = d.OBS_VALUE;
                    } else if (d.INDICATOR == "SM_POP_NMRT") {
                        result.NetMigRate = d.OBS_VALUE;
                    } else if (d.INDICATOR == "SP_POP_CHGE") {
                        result.PopChange = d.OBS_VALUE;
                    } else if (d.INDICATOR == "SP_POP_TOTL") {
                        result.PopTotal = d.OBS_VALUE;
                    } else if (d.INDICATOR == "SP_DYN_LE00") {
                        result.LifeExpect = d.OBS_VALUE;
                    } else if (d.INDICATOR == "SH_DYN_IMRT") {
                        result.InfantMort = d.OBS_VALUE;
                    } else if (d.INDICATOR == "ID") {
                        result.CountryId = d.OBS_VALUE;
                    }
                }
            });
            return result;
        });
        //Remove the underfined element in the array
        countryData = countryData.filter(function(c) {
            return c.Country !== "undefined";
        });

        var scaleOrdinal = d3.scaleOrdinal(d3.schemeCategory20c);
        var redGreen = [
            /*reds dark to light:*/
            "#E21223", "#F71629", "#FF3535", "#F75B60", "#fff", //red leaves
            /*green light to dark:*/
            "#ABFF4F", "#29BF12"
        ]; //green stay
        var grayColors = ['#d3d3d3', '#d3d3d3'];
        var colorScaleMap = d3.scaleLinear().domain([-17, -50000, -6000, -300, 0, 655555.5, 2000003]).range(redGreen);
        var grayScale = d3.scaleLinear().domain([0, 100]).range(grayColors);

        //----------------Add the zoomed out map svg----------------
        rawData = world_json_data;
        countries = topojson.feature(rawData, rawData.objects.countries);
        id_in_dict = function(val, arr) {
            return Object.values(arr).reduce((a, x) => a || val == x.id, false)
        }
        projection_out.fitExtent([
            [-2400, -850],
            [3 * svgMap.attr("width"), 3 * svgMap.attr("height")]
        ], countries);
        projection.fitExtent([
            [-5700, -2400],
            [5.87 * svgZoom.attr("width"), 5.87 * svgZoom.attr("height")]
        ], countries);
        pathGenerator_out = d3.geoPath().projection(projection_out);
        pathGenerator = d3.geoPath().projection(projection);
        var path_all = svgMap.selectAll("path.country").data(countries.features);

        path_all.enter().append("path").attr("class", "country")
            .merge(path_all)
            .attr("d", function(country) {
                return pathGenerator_out(country);
            })
            .attr("id", function(country) {
                return country.id;
            })
            .style("stroke-width", "3px")
            .style("fill", function(country, ind) {
                for (var i = 0; i < countryData.length; i++) {
                    if (countryData[i].CountryId == country.id) {
                        for (var k = countryBank.length - 1; k >= 0; k--) {
                            if (countryData[i].Country == "SYR") {
                                return "rgb(139,0,0)";
                            } else if (countryData[i].Country == countryBank[k].ThreeCode) {
                                return colorScaleMap(countryBank[k].NetMigration);
                            }
                        }

                    }
                }
                return grayScale(ind + 5 % 20);
            });
        svgMap.append("circle").attr("r", 202)
            .style("fill", "none")
            .style("stroke", "black")
            .attr("cx", 403)
            .attr("cy", 395);
        //line on left side of circle
        svgMap.append("line")
            .attr("x1", 201)
            .attr("y1", 395)
            .attr("x2", 0)
            .attr("y2", 800)
            .style("stroke", "black")
            .style("stroke-width", 1);
        //line on right side of circle
        svgMap.append("line")
            .attr("x1", 605)
            .attr("y1", 395)
            .attr("x2", 800)
            .attr("y2", 800)
            .style("stroke", "black")
            .style("stroke-width", 1);

        //Add key for the Maps
        //gradient color scale
        //This linear gradient was based on https://www.visualcinnamon.com/2016/05/smooth-color-legend-d3-svg-gradient.html
        var linearGradient = svgZoom.append("linearGradient")
            .attr("id", "linear-gradient");

        linearGradient
            .attr("x1", "0%")
            .attr("y1", "0%")
            .attr("x2", "0%")
            .attr("y2", "100%");

        svgMap.append("rect")
            .attr("x", 500)
            .attr("y", 640)
            .attr("width", 20)
            .attr("height", 150)
            .style("fill", "url(#linear-gradient)");


        linearGradient.selectAll("stop")
            .data([{
                    offset: "0%",
                    color: "#8B0000"
                },
                {
                    offset: "3%",
                    color: "#E21223"
                },
                {
                    offset: "12.5%",
                    color: "#F71629"
                },
                {
                    offset: "25%",
                    color: "#FF3535"
                },
                {
                    offset: "37.5%",
                    color: "#F75B60"
                },
                {
                    offset: "50%",
                    color: "#fff"
                },
                {
                    offset: "75%",
                    color: "#ABFF4F"
                },
                {
                    offset: "100%",
                    color: "#29BF12"
                }
            ])
            .enter().append("stop")
            .attr("offset", function(d) {
                return d.offset;
            })
            .attr("stop-color", function(d) {
                return d.color;
            });

        svgMap.append("text")
            .text("Most outgoing migration")
            .attr("x", 530)
            .attr("y", 645)
            .attr("font-size", "14px")
            .style("fill", "black")
            .attr("alignment-baseline", "central");

        svgMap.append("text")
            .text("Most incoming migration")
            .attr("x", 530)
            .attr("y", 783)
            .attr("font-size", "14px")
            .style("fill", "black")
            .attr("alignment-baseline", "central");

        //----------------Create the zoomed in map----------------
        var paths = svgZoom.selectAll("path.country").data(countries.features);
        paths.enter().append("path").attr("class", "country")
            .merge(paths)
            .attr("d", function(country) {
                if (Object.keys(id_to_country).includes('' + country.id)) {
                    return pathGenerator(country);
                }
            })
            .attr("id", function(country) {
                return country.id;
            })
            .style("stroke-width", "4px")
            .style("fill", function(country, ind) {
                for (var i = 0; i < countryData.length; i++) {
                    if (countryData[i].CountryId == country.id) {
                        for (var k = countryBank.length - 1; k >= 0; k--) {
                            if (countryData[i].Country == "SYR") {
                                return "rgb(139,0,0)";
                            } else if (countryData[i].Country == countryBank[k].ThreeCode) {
                                return colorScaleMap(countryBank[k].NetMigration);
                            }
                        };
                    }
                }
                return grayScale(ind + 5 % 20);
            });

        //Add key for the Maps
        //gradient color scale
        //This linear gradient was based on https://www.visualcinnamon.com/2016/05/smooth-color-legend-d3-svg-gradient.html
        var linearGradient = svgZoom.append("linearGradient")
            .attr("id", "linear-gradient");

        linearGradient
            .attr("x1", "0%")
            .attr("y1", "0%")
            .attr("x2", "0%")
            .attr("y2", "100%");

        svgZoom.append("rect")
            .attr("x", 30)
            .attr("y", 630)
            .attr("width", 20)
            .attr("height", 150)
            .style("fill", "url(#linear-gradient)");


        linearGradient.selectAll("stop")
            .data([{
                    offset: "0%",
                    color: "#8B0000"
                },
                {
                    offset: "3%",
                    color: "#E21223"
                },
                {
                    offset: "12.5%",
                    color: "#F71629"
                },
                {
                    offset: "25%",
                    color: "#FF3535"
                },
                {
                    offset: "37.5%",
                    color: "#F75B60"
                },
                {
                    offset: "50%",
                    color: "#fff"
                },
                {
                    offset: "75%",
                    color: "#ABFF4F"
                },
                {
                    offset: "100%",
                    color: "#29BF12"
                }               
            ])
            .enter().append("stop")
            .attr("offset", function(d) {
                return d.offset;
            })
            .attr("stop-color", function(d) {
                return d.color;
            });

        svgZoom.append("text")
            .text("Most outgoing migration")
            .attr("x", 60)
            .attr("y", 635)
            .attr("font-size", "14px")
            .style("fill", "black")
            .attr("alignment-baseline", "central");

        svgZoom.append("text")
            .text("Most incoming migration rate")
            .attr("x", 60)
            .attr("y", 773)
            .attr("font-size", "14px")
            .style("fill", "black")
            .attr("alignment-baseline", "central");

        //----------------Create Bar Chart of Net Migration----------------
        var xScale = d3.scaleLinear().domain([0, 15]).range([90, 1085]);
        var migrationScale = d3.scaleLinear().domain([-80000.4, 249999.6]).range([540, 40]);

        //add axis and labels
        var yAxis = d3.axisLeft(migrationScale);
        var plot = svgChart.append("g");
        plot.append("g").call(yAxis).attr("transform", "translate(60,0)").style("opacity", 0.75);

        svgChart.append("text")
            .text("Most incoming migration")
            .attr("x", 15)
            .attr("y", migrationScale(260000))
            .attr("font-size", "20px")
            .style("fill", "black")
            .attr("alignment-baseline", "central");

        svgChart.append("text")
            .text("Most outgoing migration")
            .attr("x", 15)
            .attr("y", migrationScale(-110000))
            .attr("font-size", "20px")
            .style("fill", "black")
            .attr("alignment-baseline", "central");

        //Line at 0
        svgChart.append("line")
            .attr("x1", 60)
            .attr("y1", migrationScale(0))
            .attr("x2", 1185)
            .attr("y2", migrationScale(0))
            .style("stroke", "black")
            .style("stroke-width", .75)
            .style("opacity", 0.75);


        //Sort the countryData by the net migration
        countryData.sort(function(a, b) {
            return parseFloat(a.NetMigration) - parseFloat(b.NetMigration);
        });
        //Sort the countryData by the net migration
        countryBank.sort(function(a, b) {
            return parseFloat(a.NetMigration) - parseFloat(b.NetMigration);
        });

        i = 0;
        countryData.forEach(function(d) {
            if (d.Country in country_id) {
                y2 = migrationScale(d.NetMigration*1000);
                if (d.NetMigration < 1) {
                    svgChart.append("line")
                        .attr("x1", xScale(i))
                        .attr("y1", migrationScale(0))
                        .attr("x2", xScale(i))
                        .attr("y2", y2)
                        .style("stroke", "#E21223")
                        .style("stroke-width", 25)
                        .style("opacity", 0.75);

                    svgChart.append("text")
                        .text(country_id[d.Country].name)
                        .attr("x", xScale(i))
                        .attr("y", y2 + 15)
                        .attr("font-size", "14px")
                        .style("fill", "black")
                        .attr("text-anchor", "middle");
                } else if (d.Country == "ARE") {
                    svgChart.append("line")
                        .attr("x1", xScale(i))
                        .attr("y1", migrationScale(0))
                        .attr("x2", xScale(i))
                        .attr("y2", y2)
                        .style("stroke", "#29BF12")
                        .style("stroke-width", 25)
                        .style("opacity", 0.75);

                    svgChart.append("text")
                        .text(country_id[d.Country].name)
                        .attr("x", xScale(i) - 6)
                        .attr("y", y2 - 10)
                        .attr("font-size", "14px")
                        .style("fill", "black")
                        .attr("text-anchor", "middle");
                } else {
                    svgChart.append("line")
                        .attr("x1", xScale(i))
                        .attr("y1", migrationScale(0))
                        .attr("x2", xScale(i))
                        .attr("y2", y2)
                        .style("stroke", "#29BF12")
                        .style("stroke-width", 25)
                        .style("opacity", 0.75);

                    svgChart.append("text")
                        .text(country_id[d.Country].name)
                        .attr("x", xScale(i))
                        .attr("y", y2 - 10)
                        .attr("font-size", "14px")
                        .style("fill", "black")
                        .attr("text-anchor", "middle");
                }
                i += 1;
            }
        });


        var xScale = d3.scaleLinear().domain([0, 15]).range([90, 1085]);
        var migrationScale_actual = d3.scaleLinear().domain([-4029996, 2000003]).range([850, 40]);

        //add axis and labels
        var yAxis = d3.axisLeft(migrationScale_actual);
        var plot = svgChartActual.append("g");
        plot.append("g").call(yAxis).attr("transform", "translate(60,0)").style("opacity", 0.75);

        svgChartActual.append("text")
            .text("Most incoming migration")
            .attr("x", 15)
            .attr("y", migrationScale_actual(2150000))
            .attr("font-size", "20px")
            .style("fill", "black")
            .attr("alignment-baseline", "central");

        svgChartActual.append("text")
            .text("Most outgoing migration")
            .attr("x", 15)
            .attr("y", migrationScale_actual(-4250000))
            .attr("font-size", "20px")
            .style("fill", "black")
            .attr("alignment-baseline", "central");

        //Line at 0
        svgChartActual.append("line")
            .attr("x1", 60)
            .attr("y1", migrationScale_actual(0))
            .attr("x2", 1185)
            .attr("y2", migrationScale_actual(0))
            .style("stroke", "black")
            .style("stroke-width", .75)
            .style("opacity", 0.75);
        var l = 0;
        countryBank.forEach(function(d) {
            if (d.ThreeCode in country_id) {
                y2 = migrationScale_actual(d.NetMigration);
               if (d.NetMigration < 1) {
                    svgChartActual.append("line")
                        .attr("x1", xScale(l))
                        .attr("y1", migrationScale_actual(0))
                        .attr("x2", xScale(l))
                        .attr("y2", y2)
                        .style("stroke", "#E21223")
                        .style("stroke-width", 25)
                        .style("opacity", 0.75);
                    svgChartActual.append("text")
                        .text(country_id[d.ThreeCode].name)
                        .attr("x", xScale(l)+5)
                        .attr("y", y2 + 15)
                        .attr("font-size", "13px")
                        .style("fill", "black")
                        .attr("text-anchor", "middle");
                }else if (d.Country == "ARE") {
                    svgChartActual.append("line")
                        .attr("x1", xScale(i))
                        .attr("y1", migrationScale_actual(0))
                        .attr("x2", xScale(i))
                        .attr("y2", y2)
                        .style("stroke", "#29BF12")
                        .style("stroke-width", 25)
                        .style("opacity", 0.75);

                    svgChartActual.append("text")
                        .text(country_id[d.ThreeCode].name)
                        .attr("x", xScale(i) +5)
                        .attr("y", y2 - 25)
                        .attr("font-size", "9px")
                        .style("fill", "black")
                        .attr("text-anchor", "middle");
                }
               else {
                    svgChartActual.append("line")
                        .attr("x1", xScale(l))
                        .attr("y1", migrationScale_actual(0))
                        .attr("x2", xScale(l))
                        .attr("y2", y2)
                        .style("stroke", "#29BF12")
                        .style("stroke-width", 25)
                        .style("opacity", 0.75);

                    svgChartActual.append("text")
                        .text(country_id[d.ThreeCode].name)
                        .attr("x", xScale(l)+5)
                        .attr("y", y2 - 10)
                        .attr("font-size", "13px")
                        .style("fill", "black")
                        .attr("text-anchor", "middle");
                }
                l += 1;
            }
        });
        popAreaData = pop_area.countries;

        //---------- Projected vs Actual Net Migration Scatter Linear Plot---------------
        
        var mideast = countries.features.filter((a) => id_to_ind.includes(a.id));
        
        function find_country_index(id) {
            notFound = true;
            i = 0;
            str_id = '' + id;
            if (str_id.length == 2) {
                str_id = "0" + str_id;
            }
            while (i < countryData.length & notFound) {
                if (countryData[i].CountryId == str_id) {
                    notFound = false;
                    return i;
                }
                i += 1;
            }
        }

        function find_countryBank_index(country_name) {
            notFound = true;
            if (country_name == "Egypt") {
                country_name = "Egypt, Arab Rep.";
            } else if (country_name == "Iran") {
                country_name = "Iran, Islamic Rep.";
            } else if (country_name == "Syria") {
                country_name = "Syrian Arab Republic";
            } else if (country_name == "Yemen") {
                country_name = "Yemen, Rep.";
            } else if (country_name == "U. Arab Emirates") {
                country_name = "United Arab Emirates";
            }

            i = 0;
            while (i < countryBank.length & notFound) {
                if (countryBank[i].Country == country_name) {
                    notFound = false;
                    return i;
                }
                i += 1;
            }

        }


        // set up scales
        // actual
        var xScale_migrate = d3.scaleLinear().domain([-4420000, 2060000]).range([30, 1350]);
        // projected
        var yScale_migrate = d3.scaleLinear().domain([-100000, 300000]).range([775, 15]);
        
        var botAxis_migrate = d3.axisBottom(xScale_migrate).ticks(8).tickSize(9);
        var leftAxis_migrate = d3.axisLeft(yScale_migrate).ticks(5).tickSize(9);

        var country_group_inf_migrate = netmigration_svg.selectAll('g')
            .data(mideast)
            .enter()
            .append('g')

        //actual data
        country_group_inf_migrate
            .append('path')
            .attr('d', function(country) {
                return pathGenerator(country);
            })
            .style("opacity", .4)
            .style("fill", function(country, ind) {
                return "purple";
            })
            .attr("transform", function(country, id) {
                [x_cent, y_cent] = projection(d3.geoPath().centroid(country));
                top_left_x = -x_cent * small_scale_country_id[country.id];
                top_left_y = -y_cent * small_scale_country_id[country.id];
                country_name = id_to_country[country.id]
                country_bank_index = find_countryBank_index(country_name)
                country_index = find_country_index(country.id)
                    
                if (countryBank[country_index] != undefined) {
                    migrate_x = xScale_migrate(Number(countryBank[country_bank_index].NetMigration))
                    migrants_projected = Number(countryData[country_index].NetMigration) *1000;
                    migrate_y = yScale_migrate(migrants_projected); 
                    
                } else {
                    migrate_x = 0;
                    migrate_y = 0;
                }
                return "translate(" + top_left_x + "," + top_left_y + ")translate(" +
                    migrate_x + "," + migrate_y + ")  scale(" + small_scale_country_id[country.id] + ") ";
            });
        // add country name for actual
        country_group_inf_migrate
            .append('text')
            .style("font-size", "10pt")
            .attr("transform", function(country, ind) {
                country_name = id_to_country[country.id]
                country_index = find_country_index(country.id)
                country_bank_index = find_countryBank_index(country_name)
                if (countryBank[country_index] != undefined) {
                    migrate_x_text = xScale_migrate(Number(countryBank[country_bank_index].NetMigration)) -10;
                    migrants_projected = Number(countryData[country_index].NetMigration) *1000;
                    migrate_y_text = yScale_migrate(migrants_projected); 
                    if (country_name == "Israel"){
                        migrate_x_text -= 35;
                        migrate_y_text += 10;
                    }
                    else if (country_name == "Bahrain"){
                        migrate_x_text += 15;
                    }
                } else {
                    migrate_y_text = 0;
                }
                return "translate(" + migrate_x_text + "," + migrate_y_text + ")";
            })
            .text(function(country) {
                return id_to_country['' + country.id];
            });
        // add axeses
        var actual_vs_projected_plot = netmigration_svg.append("g");
        actual_vs_projected_plot.append("g").style("font", "15px times")
            .call(botAxis_migrate).attr("transform", "translate(0,585)");
        actual_vs_projected_plot.append("g").style("font", "15px times")
            .call(leftAxis_migrate).attr("transform", "translate(930,0)");
        actual_vs_projected_plot
            .append("text")
            .style("font-size", "14pt")
            .attr("x", "-380")
            .attr("y", "855")
            .attr("font-weight", "bold")
            .attr("transform", "rotate(-90)")
            .text("Projected Net Migration for 2015")
        actual_vs_projected_plot.append("text")
            .text("Actual Net Migration from 2012")
            .attr("x", 90)
            .attr("y", 562)
            .attr("font-size", "20px")
            .style("fill", "black")
            .attr("font-weight", "bold")
            .attr("alignment-baseline", "central");
    }  
     </script>
</body>
</html>
